<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>WeChat Article Editor</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Zhi+Mang+Xing&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Liu+Jian+Mao+Cao&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=ZCOOL+XiaoWei&display=swap">
    <style>
        * {
            box-sizing: border-box;
        }
        html, body {
            overflow-x: hidden;
            margin: 0;
            padding: 0;
            width: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        :root {
            --spacing-large: 10px;
            --spacing-medium: 5px;
            --spacing-small: 2px;
            --heading-30px-padding: var(--spacing-large);
            --heading-20px-padding: var(--spacing-medium);
            --heading-15px-padding: var(--spacing-small);
            --text-area-font-size: 16px;
            --text-area-alignment: left;
            --text-area-offset: 0px;
            --heading-30px-font: 'Noto Serif SC', serif;
            --bg-pale-yellow: #ffeaab;
            --bg-pale-pink: #ffe6e6;
            --bg-pale-blue: #e6f3ff;
            --bg-pale-green: #e6ffe6;
            --bg-pale-gray: #f0f0f0;
            --bg-white: #ffffff;
            --bg-gray1: #f5f5f5;
            --bg-gray2: #e0e0e0;
            --bg-light-blue: #e3f2fd;
            --bg-light-yellow: #fff9c4;
            --text-yellow: #ffeb3b;
            --text-black: #000000;
            --text-white: #ffffff;
            --text-blue: #2196f3;
            --text-red: #f44336;
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --accent-color: #4CAF50;
            --glass-bg: rgba(255, 255, 255, 0.25);
            --glass-border: rgba(255, 255, 255, 0.18);
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            max-width: 375px;
            margin: 0 auto;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            touch-action: manipulation;
        }

        /* È°∂ÈÉ®Âõ∫ÂÆöÂÆπÂô® */
        .header-container {
            position: sticky;
            top: 0;
            z-index: 1000;
            width: 100%;
            max-width: 375px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
            border-radius: 0 0 20px 20px;
            padding: 20px 15px 15px 15px;
            margin-bottom: 20px;
        }

        /* Ê†áÈ¢ò */
        .app-title {
            text-align: center;
            color: #333;
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            text-shadow: 0 2px 10px rgba(255, 255, 255, 0.8);
            letter-spacing: 1px;
        }

        /* ‰∏ªË¶ÅÊìç‰ΩúÊåâÈíÆÁªÑ */
        .main-actions {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 8px;
            margin-bottom: 20px;
            padding: 0 8px;
        }

        .main-action-btn {
            padding: 12px 8px;
            background: linear-gradient(45deg, var(--accent-color), #66bb6a);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
            position: relative;
            overflow: hidden;
            text-align: center;
        }

        .main-action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .main-action-btn:hover::before {
            left: 100%;
        }

        .main-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }

        .main-action-btn:active {
            transform: translateY(0);
        }

        /* Ê¨°Ë¶ÅÊìç‰ΩúÊåâÈíÆÁªÑ */
        .secondary-actions {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .secondary-action-btn {
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .secondary-action-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-1px);
        }

        /* ÊéßÂà∂Âå∫ÂüüÊ†áÈ¢ò */
        .control-section-title {
            font-size: 13px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 12px;
            color: #333;
            text-shadow: 0 1px 3px rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            user-select: none;
            transition: all 0.3s ease;
        }
        
        .control-section-title:hover {
            color: #000;
        }
        
        .dropdown-arrow {
            font-size: 12px;
            transition: transform 0.3s ease;
            color: #666;
        }
        
        .dropdown-arrow.collapsed {
            transform: rotate(-90deg);
        }
        
        .collapsible-section {
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            max-height: 500px;
            opacity: 1;
        }
        
        .collapsible-section.collapsed {
            max-height: 0;
            margin-bottom: 0;
            opacity: 0;
            padding-top: 0;
            padding-bottom: 0;
        }

        /* È¢úËâ≤ÈÄâÊã©Âô®ÂÆπÂô® */
        .color-controls {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            justify-content: center;
            flex-wrap: wrap;
            padding: 12px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 12px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .color-btn {
            width: 32px;
            height: 32px;
            border: 2px solid rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .color-btn::after {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 6px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .color-btn:hover {
            transform: scale(1.1);
            border-color: rgba(0, 0, 0, 0.4);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        /* ‰∏∫‰∏çÂêåÈ¢úËâ≤ÊåâÈíÆÊ∑ªÂä†ÂçäÈÄèÊòéÂ∏¶Ëâ≤ÂΩ©ÁöÑËÉåÊôØ */
        .color-btn.bg-yellow {
            background: rgba(255, 234, 171, 0.8) !important;
            backdrop-filter: blur(10px);
        }
        
        .color-btn.bg-pink {
            background: rgba(255, 230, 230, 0.8) !important;
            backdrop-filter: blur(10px);
        }
        
        .color-btn.bg-blue {
            background: rgba(230, 243, 255, 0.8) !important;
            backdrop-filter: blur(10px);
        }
        
        .color-btn.bg-green {
            background: rgba(230, 255, 230, 0.8) !important;
            backdrop-filter: blur(10px);
        }
        
        .color-btn.bg-gray {
            background: rgba(240, 240, 240, 0.8) !important;
            backdrop-filter: blur(10px);
        }
        
        .color-btn.text-yellow {
            background: rgba(255, 235, 59, 0.8) !important;
            backdrop-filter: blur(10px);
        }
        
        .color-btn.text-black {
            background: rgba(60, 60, 60, 0.8) !important;
            backdrop-filter: blur(10px);
        }
        
        .color-btn.text-white {
            background: rgba(255, 255, 255, 0.8) !important;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(0, 0, 0, 0.3) !important;
        }
        
        .color-btn.text-blue {
            background: rgba(33, 150, 243, 0.8) !important;
            backdrop-filter: blur(10px);
        }
        
        .color-btn.text-red {
            background: rgba(244, 67, 54, 0.8) !important;
            backdrop-filter: blur(10px);
        }
        
        .color-btn.bg-white {
            background: rgba(255, 255, 255, 0.8) !important;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(0, 0, 0, 0.3) !important;
        }
        
        .color-btn.bg-gray1 {
            background: rgba(245, 245, 245, 0.8) !important;
            backdrop-filter: blur(10px);
        }
        
        .color-btn.bg-gray2 {
            background: rgba(224, 224, 224, 0.8) !important;
            backdrop-filter: blur(10px);
        }
        
        .color-btn.bg-light-blue {
            background: rgba(227, 242, 253, 0.8) !important;
            backdrop-filter: blur(10px);
        }
        
        .color-btn.bg-light-yellow {
            background: rgba(255, 249, 196, 0.8) !important;
            backdrop-filter: blur(10px);
        }

        /* Â∑•ÂÖ∑ÊåâÈíÆ */
        .tool-controls {
            display: flex;
            gap: 6px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 15px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 12px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .tool-btn {
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.8);
            color: #333;
            border: 1px solid rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            min-width: 60px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .tool-btn:hover {
            background: rgba(255, 255, 255, 0.9);
            border-color: rgba(0, 0, 0, 0.3);
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
        }

        .tool-btn.active {
            background: rgba(76, 175, 80, 0.8);
            border-color: var(--accent-color);
            color: white;
        }

        /* ÂÜÖÂÆπÂå∫Âüü */
        .content-wrapper {
            width: 100%;
            max-width: 375px;
            padding: 0 15px 20px 15px;
        }

        .content-container {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .container-unit {
            width: 100%;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: var(--spacing-medium);
            margin-bottom: var(--spacing-large);
            position: relative;
            background: rgba(255, 234, 171, 0.3);
            backdrop-filter: blur(15px);
            border-radius: 16px;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }
        .module-container {
            width: 100%;
            margin-bottom: 0;
        }
        .module-unit {
            margin-bottom: var(--spacing-small);
        }
        .text-area-container, .heading-container, .image-area, .line-container, .spacer-container {
            width: 100%;
            position: relative;
        }
        .text-area {
            width: 100%;
            min-height: 100px;
            padding: var(--spacing-medium) 12px;
            border: 1px solid #ccc;
            box-sizing: border-box;
            resize: vertical;
            text-align: var(--text-area-alignment);
            white-space: pre-wrap;
            font-family: SimSun, Arial, sans-serif;
            font-size: var(--text-area-font-size);
        }
        .heading-30px, .heading-20px, .heading-15px {
            width: 100%;
            font-weight: bold;
            text-align: center;
            border: 1px solid #ccc;
            padding: var(--spacing-medium);
            box-sizing: border-box;
            font-family: var(--heading-30px-font) !important;
            position: relative;
        }
        .heading-30px {
            font-size: 30px;
            color: var(--text-red);
            padding: var(--spacing-medium) 0;
            background-size: cover;
            background-position: center;
            position: relative;
            z-index: 1;
        }
        .heading-30px-blur {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            filter: blur(25px);
            overflow: hidden;
            z-index: -1;
            border-radius: 10px;
            transform: scale(1.1);
        }
        
        .heading-blur-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            filter: blur(8px);
            overflow: hidden;
            z-index: 0;
            border-radius: 10px;
            pointer-events: none;
        }
        .heading-20px {
            font-size: 20px;
        }
        .heading-15px {
            font-size: 15px;
        }
        .image-area {
            border: none;
            padding: 0;
            box-sizing: border-box;
            min-height: 50px;
            background: transparent;
            border-radius: 0;
            backdrop-filter: none;
            position: relative;
        }
        
        .image-area:hover {
            border: none;
            background: transparent;
        }
        .image-grid {
            margin-bottom: var(--spacing-small);
        }
        .image-grid.single {
            display: block;
            padding: 5px;
        }
        .image-grid.two {
            display: flex;
            gap: var(--spacing-small);
            padding: 5px;
        }
        .image-grid.multiple {
            column-count: 2;
            column-gap: var(--spacing-small);
            column-width: calc((100% - var(--spacing-small)) / 2);
            padding: 5px;
        }
        .image-container {
            position: relative;
            width: 100%;
            margin-bottom: var(--spacing-small);
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .image-grid.two .image-container {
            flex: 1;
        }
        
        .image-container:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .inserted-image {
            width: 100%;
            height: auto;
            display: block;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .image-container:hover .inserted-image {
            transform: scale(1.02);
        }
        .delete-image-button {
            position: absolute;
            bottom: 8px;
            right: 8px;
            padding: 6px 10px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 
                0 3px 10px rgba(238, 90, 82, 0.3),
                0 1px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .delete-image-button:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 5px 15px rgba(238, 90, 82, 0.4),
                0 2px 6px rgba(0, 0, 0, 0.15);
            background: linear-gradient(135deg, #ff5252, #e53935);
        }
        .delete-image-button:active {
            transform: translateY(0);
        }
        .add-image-button {
            position: absolute;
            top: 5px;
            left: 5px;
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 
                0 4px 12px rgba(76, 175, 80, 0.3),
                0 2px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        .add-image-button:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 
                0 6px 20px rgba(76, 175, 80, 0.4),
                0 3px 10px rgba(0, 0, 0, 0.15);
            background: linear-gradient(135deg, #66bb6a, #4CAF50);
        }
        .add-image-button:active {
            transform: scale(1.05) rotate(90deg);
        }
        .add-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(48px, 1fr));
            gap: 8px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 375px;
            margin: 10px 0;
        }
        .add-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 6px 4px;
            background: linear-gradient(145deg, #ffffff, #f0f0f0);
            color: #333;
            border: none;
            border-radius: 12px;
            font-size: 8px;
            font-weight: 600;
            cursor: pointer;
            min-height: 48px;
            min-width: 48px;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            box-shadow: 
                0 2px 4px rgba(0, 0, 0, 0.1),
                0 1px 2px rgba(0, 0, 0, 0.08),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            position: relative;
            overflow: hidden;
        }
        
        .add-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(145deg, transparent, rgba(255, 255, 255, 0.1));
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .add-button:hover::before {
            opacity: 1;
        }
        
        .add-button:hover {
            transform: translateY(-1px) scale(1.02);
            box-shadow: 
                0 4px 12px rgba(0, 0, 0, 0.15),
                0 2px 4px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.9);
        }
        
        .add-button:active {
            transform: translateY(0) scale(0.98);
            box-shadow: 
                0 1px 4px rgba(0, 0, 0, 0.15),
                0 1px 2px rgba(0, 0, 0, 0.1),
                inset 0 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        .add-button .label {
            font-size: 12px;
            font-weight: 600;
            color: #333;
            text-shadow: 0 1px 1px rgba(255, 255, 255, 0.8);
            line-height: 1;
        }
        
        /* ‰∏∫‰∏çÂêåÁ±ªÂûãÁöÑÊåâÈíÆËÆæÁΩÆ‰∏çÂêåÁöÑÊ∏êÂèòËâ≤ */
        .add-button.text-btn {
            background: linear-gradient(145deg, #667eea, #764ba2);
            color: white;
        }
        
        .add-button.image-btn {
            background: linear-gradient(145deg, #f093fb, #f5576c);
            color: white;
        }
        
        .add-button.heading-btn {
            background: linear-gradient(145deg, #4facfe, #00f2fe);
            color: white;
        }
        
        .add-button.line-btn {
            background: linear-gradient(145deg, #43e97b, #38f9d7);
            color: white;
        }
        
        .add-button.spacer-btn {
            background: linear-gradient(145deg, #fa709a, #fee140);
            color: white;
        }
        
        .add-button.text-btn .label,
        .add-button.image-btn .label,
        .add-button.heading-btn .label,
        .add-button.line-btn .label,
        .add-button.spacer-btn .label {
            color: rgba(255, 255, 255, 0.95);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            font-weight: 600;
        }
        .hidden {
            display: none;
        }
        .text-buttons, .image-area-buttons {
            position: absolute;
            bottom: var(--spacing-small);
            right: var(--spacing-small);
            display: flex;
            gap: var(--spacing-small);
            z-index: 10;
        }
        .container-controls {
            display: flex;
            gap: var(--spacing-small);
            margin-bottom: var(--spacing-medium);
        }
        .text-button, .delete-module-button, .clear-button, .background-button, .delete-container-button, .change-bg-button {
            padding: var(--spacing-small) var(--spacing-medium);
            background-color: #666;
            color: white;
            border: none;
            border-radius: 3px;
            font-size: 12px;
            cursor: pointer;
        }
        .text-button:hover, .clear-button:hover, .background-button:hover, .change-bg-button:hover {
            background-color: #555;
        }
        .delete-module-button, .delete-container-button {
            background-color: #e74c3c;
        }
        .delete-module-button:hover, .delete-container-button:hover {
            background-color: #c0392b;
        }
        .divider-line {
            width: calc(100% - var(--spacing-medium) * 2);
            height: 1px;
            background-color: #ccc;
            margin: 0 auto;
        }
        .spacer {
            height: var(--spacing-large);
            background-color: white;
        }
        .preview-mode .add-buttons, .preview-mode .text-buttons, .preview-mode .image-area-buttons, .preview-mode .add-image-button, .preview-mode .delete-image-button, .preview-mode .container-controls {
            display: none;
        }
        .preview-mode .text-area, .preview-mode .heading-30px, .preview-mode .heading-20px, .preview-mode .heading-15px {
            border: none;
            pointer-events: none;
        }
        .preview-mode .text-area {
            height: auto;
            min-height: auto;
            resize: none;
            padding: var(--spacing-medium);
            overflow: visible;
            font-size: var(--text-area-font-size);
            line-height: 1.6;
            border-radius: var(--spacing-small);
            text-indent: 2em;
            text-align: var(--text-area-alignment);
            background: none;
        }
        .preview-mode .image-area {
            border: none;
            padding: 0;
        }
        .preview-mode .container-unit {
            border: none;
            padding: 0;
        }
        .preview-mode .heading-30px {
            padding: 30px;
            background-color: var(--bg-pale-pink);
            width: 100%;
            position: relative;
            font-family: var(--heading-30px-font);
            background-size: cover;
            background-position: center;
            margin-bottom: -3px;
            border-radius: 10px;
        }
        .preview-mode .heading-30px-blur {
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            background-size: cover;
            background-position: center;
            filter: blur(13px);
            overflow: hidden;
            z-index: -1;
        }
        .preview-mode .heading-20px {
            padding: var(--heading-20px-padding) var(--spacing-medium);
            background: none;
            width: 150%;
            position: relative;
            left: -25%;
        }
        .preview-mode .heading-15px {
            padding: var(--heading-15px-padding) var(--spacing-medium);
            background: none;
        }
    </style>
</head>
<body>
    <!-- ÁæéÂåñÁöÑÈ°∂ÈÉ®ÂÆπÂô® -->
    <div class="header-container">
        <div class="app-title">üìù ÂæÆ‰ø°ÊñáÁ´†ÁºñËæëÂô®</div>
        
        <!-- ‰∏ªË¶ÅÊìç‰Ωú -->
        <div class="main-actions">
            <button class="main-action-btn" onclick="togglePreviewMode()">
                <span id="preview-text">È¢ÑËßàÊ®°Âºè</span>
            </button>
            <button class="main-action-btn" onclick="shareAllContainers()">
                ÂàÜ‰∫´Âà∞ÂæÆ‰ø°
            </button>
            <button class="main-action-btn" onclick="addContainer()">
                Ê∑ªÂä†ÂÆπÂô®
            </button>
            <button class="main-action-btn" onclick="addContainerWithoutBackground()">
                Êó†ËÉåÊôØÂÆπÂô®
            </button>
        </div>

        <!-- ÊñáÊú¨ËÉåÊôØËâ≤ -->
        <div class="control-section-title" onclick="toggleSection('bg-colors')">
            üé® ÊñáÊú¨ËÉåÊôØËâ≤
            <span class="dropdown-arrow">‚ñº</span>
        </div>
        <div class="collapsible-section" id="bg-colors">
            <div class="color-controls">
                <button class="color-btn bg-yellow" style="background-color: var(--bg-pale-yellow);" onclick="setContainerBackground('var(--bg-pale-yellow)')"></button>
                <button class="color-btn bg-pink" style="background-color: var(--bg-pale-pink);" onclick="setContainerBackground('var(--bg-pale-pink)')"></button>
                <button class="color-btn bg-blue" style="background-color: var(--bg-pale-blue);" onclick="setContainerBackground('var(--bg-pale-blue)')"></button>
                <button class="color-btn bg-green" style="background-color: var(--bg-pale-green);" onclick="setContainerBackground('var(--bg-pale-green)')"></button>
                <button class="color-btn bg-gray" style="background-color: var(--bg-pale-gray);" onclick="setContainerBackground('var(--bg-pale-gray)')"></button>
            </div>
        </div>

        <!-- Ê†áÈ¢òËÆæÁΩÆ -->
        <div class="control-section-title" onclick="toggleSection('heading-settings')">
            ‚ú® Ê†áÈ¢òËÆæÁΩÆ
            <span class="dropdown-arrow">‚ñº</span>
        </div>
        <div class="collapsible-section" id="heading-settings">
            <div class="color-controls">
                <button class="color-btn text-yellow" style="background-color: var(--text-yellow);" onclick="setHeadingTextColor('var(--text-yellow)')"></button>
                <button class="color-btn text-black" style="background-color: var(--text-black);" onclick="setHeadingTextColor('var(--text-black)')"></button>
                <button class="color-btn text-white" style="background-color: var(--text-white);" onclick="setHeadingTextColor('var(--text-white)')"></button>
                <button class="color-btn text-blue" style="background-color: var(--text-blue);" onclick="setHeadingTextColor('var(--text-blue)')"></button>
                <button class="color-btn text-red" style="background-color: var(--text-red);" onclick="setHeadingTextColor('var(--text-red)')"></button>
            </div>
            <div class="tool-controls">
                <button class="tool-btn" id="border-btn" onclick="toggleHeadingBorder()">ËæπÊ°ÜÂºÄ</button>
                <button class="tool-btn" id="blur-btn" onclick="toggleHeadingBlur()">Èò¥ÂΩ±ÂºÄ</button>
                <button class="tool-btn" id="bg-blur-btn" onclick="toggleBackgroundBlur()">ÂõæÁâáÊ®°Á≥äÂºÄ</button>
                <button class="tool-btn" onclick="toggleHeadingExpand()">Ê†áÈ¢òÂä†ÂÆΩ</button>
            </div>
        </div>

        <!-- Êï¥‰ΩìËÉåÊôØËâ≤ -->
        <div class="control-section-title" onclick="toggleSection('gradient-backgrounds')">
            üé® Êï¥‰ΩìËÉåÊôØËâ≤
            <span class="dropdown-arrow collapsed">‚ñº</span>
        </div>
        <div class="collapsible-section collapsed" id="gradient-backgrounds">
            <div class="color-controls">
                <button class="color-btn bg-white" style="background-color: var(--bg-white);" onclick="setGradientBackground('white')"></button>
                <button class="color-btn bg-gray1" style="background-color: var(--bg-gray1);" onclick="setGradientBackground('gray1')"></button>
                <button class="color-btn bg-gray2" style="background-color: var(--bg-gray2);" onclick="setGradientBackground('gray2')"></button>
                <button class="color-btn bg-light-blue" style="background-color: var(--bg-light-blue);" onclick="setGradientBackground('light-blue')"></button>
                <button class="color-btn bg-light-yellow" style="background-color: var(--bg-light-yellow);" onclick="setGradientBackground('light-yellow')"></button>
            </div>
        </div>

        <!-- ÊñáÊú¨ËÆæÁΩÆ -->
        <div class="control-section-title" onclick="toggleSection('text-settings')">
            üìù ÊñáÊú¨ËÆæÁΩÆ
            <span class="dropdown-arrow">‚ñº</span>
        </div>
        <div class="collapsible-section" id="text-settings">
            <div class="tool-controls">
                <button class="tool-btn" onclick="adjustTextSize(2)">A+</button>
                <button class="tool-btn" onclick="adjustTextSize(-2)">A-</button>
                <button class="tool-btn" onclick="adjustTextOffset(-2)">Â∑¶ÂÅèÁßª</button>
                <button class="tool-btn" onclick="adjustTextOffset(2)">Âè≥ÂÅèÁßª</button>
                <button class="tool-btn" onclick="setTextAlignment('left')">Â∑¶ÂØπÈΩê</button>
                <button class="tool-btn" onclick="setTextAlignment('center')">‰∏≠ÂØπÈΩê</button>
            </div>
        </div>

        <!-- Ê†áÈ¢òÂ≠ó‰Ωì -->
        <div class="control-section-title" onclick="toggleSection('font-settings')">
            üñãÔ∏è Ê†áÈ¢òÂ≠ó‰Ωì
            <span class="dropdown-arrow collapsed">‚ñº</span>
        </div>
        <div class="collapsible-section collapsed" id="font-settings">
            <div class="tool-controls">
                <button class="tool-btn" onclick="setHeadingFont('\'Ma Shan Zheng\', cursive')">ÊØõÁ¨îÂ≠ó</button>
                <button class="tool-btn" onclick="setHeadingFont('\'Zhi Mang Xing\', cursive')">ÊâãÂÜô‰Ωì</button>
                <button class="tool-btn" onclick="setHeadingFont('\'Liu Jian Mao Cao\', cursive')">Ëçâ‰π¶</button>
                <button class="tool-btn" onclick="setHeadingFont('\'ZCOOL KuaiLe\', sans-serif')">Âø´‰πê‰Ωì</button>
                <button class="tool-btn" onclick="setHeadingFont('\'ZCOOL XiaoWei\', serif')">Â∞èÂæÆ‰Ωì</button>
                <button class="tool-btn" onclick="setHeadingFont('\'Noto Serif SC\', serif')">ÂÆã‰Ωì</button>
                <button class="tool-btn" onclick="setHeadingFont('\'Noto Sans SC\', sans-serif')">Èªë‰Ωì</button>
            </div>
        </div>
    </div>

    <!-- ÂÜÖÂÆπÂå∫Âüü -->
    <div class="content-wrapper">
        <div id="content" class="content-container">
            <div class="container-unit" id="initial-heading-container">
                <div class="container-controls">
                    <button class="delete-container-button" onclick="this.closest('.container-unit').remove()">Âà†Èô§ÂÆπÂô®</button>
                    <button class="change-bg-button" onclick="changeContainerBackground(this.closest('.container-unit'))">Êõ¥ÊîπËÉåÊôØ</button>
                </div>
                <div class="module-container module-unit">
                    <div class="heading-container">
                        <div class="heading-30px" contenteditable="true">ËæìÂÖ•Ê†áÈ¢ò</div>
                    </div>
                    <div class="text-buttons">
                        <button class="background-button" onclick="document.getElementById('background-upload-initial').click()">ÈÄâÊã©ËÉåÊôØÂõæÁâá</button>
                        <input type="file" accept="image/*" class="hidden" id="background-upload-initial" onchange="setHeadingBackground(this, this.closest('.module-container').querySelector('.heading-30px'))">
                        <button class="text-button" onclick="selectHeadingText(this)">ÂÖ®ÈÄâ</button>
                        <button class="text-button" onclick="pasteHeadingText(this)">Á≤òË¥¥</button>
                        <button class="clear-button" onclick="clearHeadingText(this)">Ê∏ÖÁ©∫</button>
                        <button class="delete-module-button" onclick="this.closest('.module-container').remove()">Âà†Èô§</button>
                    </div>
                </div>
            </div>
            <div class="container-unit" id="initial-content-container">
                <div class="container-controls">
                    <button class="delete-container-button" onclick="this.closest('.container-unit').remove()">Âà†Èô§ÂÆπÂô®</button>
                    <button class="change-bg-button" onclick="changeContainerBackground(this.closest('.container-unit'))">Êõ¥ÊîπËÉåÊôØ</button>
                </div>
                <div class="module-container module-unit" id="initial-module">
                    <div class="add-buttons" id="initial-buttons">
                        <button class="add-button text-btn" onclick="addTextArea('initial-buttons')">
                            <div class="label">ÊñáÊú¨</div>
                        </button>
                        <button class="add-button image-btn" onclick="addImageArea('initial-buttons')">
                            <div class="label">ÂõæÁâá</div>
                        </button>
                        <button class="add-button heading-btn" onclick="addHeading('initial-buttons', '30px')">
                            <div class="label">Ê†áÈ¢ò30</div>
                        </button>
                        <button class="add-button heading-btn" onclick="addHeading('initial-buttons', '20px')">
                            <div class="label">Ê†áÈ¢ò20</div>
                        </button>
                        <button class="add-button heading-btn" onclick="addHeading('initial-buttons', '15px')">
                            <div class="label">Ê†áÈ¢ò15</div>
                        </button>
                        <button class="add-button line-btn" onclick="addDividerLine('initial-buttons')">
                            <div class="label">ÂàÜÂâ≤Á∫ø</div>
                        </button>
                        <button class="add-button spacer-btn" onclick="addSpacer('initial-buttons')">
                            <div class="label">Èó¥Èöî</div>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let isHeadingBorderOn = false;
        let isHeadingBlurOn = false;
        let isBackgroundBlurOn = false;
        let isHeadingExpandOn = false;

        function setGradientBackground(colorType) {
            const body = document.body;
            
            // ÂÆö‰πâ‰∏çÂêåÁöÑÁ¥´Ëâ≤Ê∏êÂèòËÉåÊôØ
            const gradients = {
                'white': 'linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%)',
                'gray1': 'linear-gradient(135deg, #f1f3f4 0%, #dadce0 100%)',
                'gray2': 'linear-gradient(135deg, #e8eaed 0%, #bdc1c6 100%)',
                'light-blue': 'linear-gradient(135deg, #e3f2fd 0%, #bbdefb 50%, #90caf9 100%)',
                'light-yellow': 'linear-gradient(135deg, #fff9c4 0%, #fff59d 50%, #ffee58 100%)'
            };
            
            // Â∫îÁî®Êñ∞ÁöÑÊ∏êÂèòËÉåÊôØ
            if (gradients[colorType]) {
                body.style.background = gradients[colorType];
                console.log(`Applied gradient background: ${colorType}`);
            }
        }

        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId);
            const arrow = event.currentTarget.querySelector('.dropdown-arrow');
            
            if (section.classList.contains('collapsed')) {
                // Â±ïÂºÄ
                section.classList.remove('collapsed');
                arrow.classList.remove('collapsed');
            } else {
                // Êî∂Ëµ∑
                section.classList.add('collapsed');
                arrow.classList.add('collapsed');
            }
        }

        function togglePreviewMode() {
            document.body.classList.toggle('preview-mode');
            const previewText = document.getElementById('preview-text');
            previewText.textContent = document.body.classList.contains('preview-mode') ? 'ÈÄÄÂá∫È¢ÑËßà' : 'È¢ÑËßàÊ®°Âºè';
            const textAreas = document.querySelectorAll('.text-area');
            textAreas.forEach(ta => {
                if (document.body.classList.contains('preview-mode')) {
                    ta.style.height = 'auto';
                    ta.style.height = `${ta.scrollHeight}px`;
                } else {
                    ta.style.height = '';
                }
            });
        }

        function adjustTextOffset(change) {
            const root = document.documentElement;
            const currentOffset = parseFloat(getComputedStyle(root).getPropertyValue('--text-area-offset')) || 0;
            const newOffset = Math.min(Math.max(currentOffset + change, -20), 20); // ÈôêÂà∂Âú®-20pxÂà∞20px‰πãÈó¥
            root.style.setProperty('--text-area-offset', `${newOffset}px`);
            
            // Á´ãÂç≥Â∫îÁî®Âà∞ÊâÄÊúâÁé∞ÊúâÁöÑÊñáÊú¨Âå∫Âüü
            const textAreas = document.querySelectorAll('.text-area');
            textAreas.forEach(textarea => {
                textarea.style.paddingLeft = `calc(12px + ${newOffset}px)`;
                // Âº∫Âà∂ÈáçÊñ∞Ê∏≤Êüì
                textarea.style.display = 'none';
                textarea.offsetHeight; // Ëß¶ÂèëÈáçÊéí
                textarea.style.display = '';
            });
            
            console.log('Text offset changed to:', newOffset + 'px'); // Ë∞ÉËØïÁî®
            console.log('Applied to', textAreas.length, 'text areas'); // Ë∞ÉËØïÁî®
        }

        function adjustTextSize(change) {
            const root = document.documentElement;
            const currentSize = parseFloat(getComputedStyle(root).getPropertyValue('--text-area-font-size')) || 16;
            const newSize = Math.min(Math.max(currentSize + change, 12), 24);
            root.style.setProperty('--text-area-font-size', `${newSize}px`);
            const textAreas = document.querySelectorAll('.text-area');
            textAreas.forEach(ta => {
                if (document.body.classList.contains('preview-mode')) {
                    ta.style.height = 'auto';
                    ta.style.height = `${ta.scrollHeight}px`;
                }
            });
        }

        function setTextAlignment(alignment) {
            document.documentElement.style.setProperty('--text-area-alignment', alignment);
        }

        function setHeadingFont(font) {
            console.log('Setting font to:', font); // Ë∞ÉËØïÁî®
            
            // Êõ¥Êñ∞CSSÂèòÈáè
            document.documentElement.style.setProperty('--heading-30px-font', font);
            
            // ‰ΩøÁî®FontFace APIÊ£ÄÊü•Â≠ó‰ΩìÊòØÂê¶Âä†ËΩΩÂÆåÊàê
            const fontName = font.split(',')[0].replace(/['"]/g, '');
            
            if (document.fonts && document.fonts.check) {
                if (!document.fonts.check(`16px ${fontName}`)) {
                    console.log('Font not loaded yet, waiting...');
                    document.fonts.ready.then(() => {
                        applyFontToHeadings(font);
                    });
                } else {
                    applyFontToHeadings(font);
                }
            } else {
                // Â¶ÇÊûú‰∏çÊîØÊåÅFontFace APIÔºåÁõ¥Êé•Â∫îÁî®
                applyFontToHeadings(font);
            }
            
            // È´ò‰∫ÆÈÄâ‰∏≠ÁöÑÂ≠ó‰ΩìÊåâÈíÆ
            highlightActiveButton(font);
        }
        
        function applyFontToHeadings(font) {
            // Á´ãÂç≥Â∫îÁî®Âà∞ÊâÄÊúâÁé∞ÊúâÁöÑÊ†áÈ¢ò
            const allHeadings = document.querySelectorAll('.heading-30px, .heading-20px, .heading-15px');
            
            allHeadings.forEach(heading => {
                heading.style.fontFamily = font + ' !important';
                // Âº∫Âà∂ÈáçÊñ∞Ê∏≤Êüì
                heading.style.display = 'none';
                heading.offsetHeight; // Ëß¶ÂèëÈáçÊéí
                heading.style.display = '';
                console.log('Applied font to heading:', heading.className, font); // Ë∞ÉËØïÁî®
            });
        }
        
        function highlightActiveButton(font) {
            const fontButtons = document.querySelectorAll('.tool-controls .tool-btn');
            fontButtons.forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Ê†πÊçÆÂ≠ó‰ΩìÂêçÁß∞È´ò‰∫ÆÂØπÂ∫îÊåâÈíÆ
            fontButtons.forEach(btn => {
                const btnText = btn.textContent.trim();
                let shouldActivate = false;
                
                if (font.includes('Ma Shan Zheng') && btnText === 'ÊØõÁ¨îÂ≠ó') shouldActivate = true;
                else if (font.includes('Zhi Mang Xing') && btnText === 'ÊâãÂÜô‰Ωì') shouldActivate = true;
                else if (font.includes('Liu Jian Mao Cao') && btnText === 'Ëçâ‰π¶') shouldActivate = true;
                else if (font.includes('ZCOOL KuaiLe') && btnText === 'Âø´‰πê‰Ωì') shouldActivate = true;
                else if (font.includes('ZCOOL XiaoWei') && btnText === 'Â∞èÂæÆ‰Ωì') shouldActivate = true;
                else if (font.includes('Noto Serif SC') && btnText === 'ÂÆã‰Ωì') shouldActivate = true;
                else if (font.includes('Noto Sans SC') && btnText === 'Èªë‰Ωì') shouldActivate = true;
                
                if (shouldActivate) {
                    btn.classList.add('active');
                }
            });
        }

        function setContainerBackground(color) {
            const containers = document.querySelectorAll('.container-unit:not([data-no-background="true"])');
            containers.forEach(container => {
                // Â∞ÜCSSÂèòÈáèËΩ¨Êç¢‰∏∫ÂçäÈÄèÊòéÊïàÊûú
                let transparentColor;
                switch(color) {
                    case 'var(--bg-pale-yellow)':
                        transparentColor = 'rgba(255, 234, 171, 0.3)';
                        break;
                    case 'var(--bg-pale-pink)':
                        transparentColor = 'rgba(255, 230, 230, 0.3)';
                        break;
                    case 'var(--bg-pale-blue)':
                        transparentColor = 'rgba(230, 243, 255, 0.3)';
                        break;
                    case 'var(--bg-pale-green)':
                        transparentColor = 'rgba(230, 255, 230, 0.3)';
                        break;
                    case 'var(--bg-pale-gray)':
                        transparentColor = 'rgba(240, 240, 240, 0.3)';
                        break;
                    default:
                        transparentColor = 'rgba(255, 234, 171, 0.3)';
                }
                container.style.background = transparentColor;
                container.style.backdropFilter = 'blur(15px)';
            });
        }

        function setHeadingTextColor(color) {
            const headings = document.querySelectorAll('.heading-30px');
            headings.forEach(heading => {
                heading.style.color = color;
                if (isHeadingBorderOn) {
                    heading.style.border = `2px solid ${color}`;
                }
            });
        }

        function toggleHeadingBorder() {
            isHeadingBorderOn = !isHeadingBorderOn;
            const headings = document.querySelectorAll('.heading-30px');
            const button = document.getElementById('border-btn');
            headings.forEach(heading => {
                const currentColor = getComputedStyle(heading).color;
                heading.style.border = isHeadingBorderOn ? `2px solid ${currentColor}` : 'none';
            });
            button.textContent = isHeadingBorderOn ? 'ËæπÊ°ÜÂÖ≥' : 'ËæπÊ°ÜÂºÄ';
            button.classList.toggle('active', isHeadingBorderOn);
        }

        function toggleHeadingExpand() {
            isHeadingExpandOn = !isHeadingExpandOn;
            const headings = document.querySelectorAll('.heading-30px');
            const button = document.querySelector('[onclick="toggleHeadingExpand()"]');
            
            headings.forEach(heading => {
                if (isHeadingExpandOn) {
                    // Âä†ÂÆΩÔºö‰∏§‰æßÈ°∂Êª°ÔºåÂéªÊéâÂúÜËßí
                    heading.style.width = 'calc(100% + 20px)';
                    heading.style.marginLeft = '-10px';
                    heading.style.marginRight = '-10px';
                    heading.style.borderRadius = '0';
                    // Â¶ÇÊûúÊúâÊ®°Á≥äËÉåÊôØÂ±ÇÔºå‰πüË¶ÅË∞ÉÊï¥
                    const blurDiv = heading.querySelector('.heading-30px-blur');
                    if (blurDiv) {
                        blurDiv.style.borderRadius = '0';
                    }
                } else {
                    // ÊÅ¢Â§çÊ≠£Â∏∏ÔºöÊÅ¢Â§çÂéüÂßãÂÆΩÂ∫¶ÂíåÂúÜËßí
                    heading.style.width = '100%';
                    heading.style.marginLeft = '0';
                    heading.style.marginRight = '0';
                    heading.style.borderRadius = '10px';
                    // Â¶ÇÊûúÊúâÊ®°Á≥äËÉåÊôØÂ±ÇÔºå‰πüË¶ÅÊÅ¢Â§ç
                    const blurDiv = heading.querySelector('.heading-30px-blur');
                    if (blurDiv) {
                        blurDiv.style.borderRadius = '10px';
                    }
                }
            });
            
            button.textContent = isHeadingExpandOn ? 'Ê†áÈ¢òÂä†ÂÆΩÂÖ≥' : 'Ê†áÈ¢òÂä†ÂÆΩ';
        }

        function toggleBackgroundBlur() {
            isBackgroundBlurOn = !isBackgroundBlurOn;
            const headings = document.querySelectorAll('.heading-30px');
            const button = document.getElementById('bg-blur-btn');
            
            headings.forEach(heading => {
                const bgImage = heading.style.backgroundImage;
                if (bgImage && bgImage !== 'none') {
                    let blurDiv = heading.querySelector('.heading-30px-blur');
                    
                    if (isBackgroundBlurOn) {
                        // ÂàõÂª∫ÊàñÊõ¥Êñ∞Ê®°Á≥äËÉåÊôØÂ±Ç
                        if (!blurDiv) {
                            blurDiv = document.createElement('div');
                            blurDiv.className = 'heading-30px-blur';
                            heading.prepend(blurDiv);
                        }
                        blurDiv.style.backgroundImage = bgImage;
                        blurDiv.style.filter = 'blur(25px)';
                        blurDiv.style.position = 'absolute';
                        blurDiv.style.top = '0';
                        blurDiv.style.left = '0';
                        blurDiv.style.right = '0';
                        blurDiv.style.bottom = '0';
                        blurDiv.style.backgroundSize = 'cover';
                        blurDiv.style.backgroundPosition = 'center';
                        blurDiv.style.overflow = 'hidden';
                        blurDiv.style.zIndex = '-1';
                        
                        // Ê†πÊçÆÂä†ÂÆΩÁä∂ÊÄÅËÆæÁΩÆÂúÜËßí
                        blurDiv.style.borderRadius = isHeadingExpandOn ? '0' : '10px';
                        
                        // ÁªôÊ†áÈ¢òÊ∑ªÂä†ÂçäÈÄèÊòéËÉåÊôØÔºåÁ±ª‰ººMacÈ£éÊ†º
                        heading.style.backgroundColor = 'rgba(255, 255, 255, 0.25)';
                        heading.style.backdropFilter = 'blur(8px)';
                        heading.style.border = '1px solid rgba(255, 255, 255, 0.3)';
                        heading.style.overflow = 'hidden'; // Á°Æ‰øù‰∏ç‰ºöÊ∫¢Âá∫
                    } else {
                        // ÁßªÈô§Ê®°Á≥äÊïàÊûú
                        if (blurDiv) {
                            blurDiv.remove();
                        }
                        heading.style.backgroundColor = '';
                        heading.style.backdropFilter = '';
                        heading.style.border = '';
                        heading.style.overflow = '';
                    }
                }
            });
            
            button.textContent = isBackgroundBlurOn ? 'ÂõæÁâáÊ®°Á≥äÂÖ≥' : 'ÂõæÁâáÊ®°Á≥äÂºÄ';
            button.classList.toggle('active', isBackgroundBlurOn);
        }

        function toggleHeadingBlur() {
            isHeadingBlurOn = !isHeadingBlurOn;
            const headings = document.querySelectorAll('.heading-30px');
            const button = document.getElementById('blur-btn');
            
            headings.forEach(heading => {
                if (isHeadingBlurOn) {
                    // Ê∑ªÂä†Ê≠£Â∏∏ÁöÑÈªëËâ≤ÂçäÈÄèÊòéÈò¥ÂΩ±
                    heading.style.textShadow = '0 4px 8px rgba(0, 0, 0, 0.3), 0 2px 4px rgba(0, 0, 0, 0.2)';
                    heading.style.boxShadow = '0 8px 32px rgba(0, 0, 0, 0.2), 0 4px 16px rgba(0, 0, 0, 0.1)';
                } else {
                    // ÁßªÈô§Èò¥ÂΩ±
                    heading.style.textShadow = 'none';
                    heading.style.boxShadow = 'none';
                }
            });
            
            button.textContent = isHeadingBlurOn ? 'Èò¥ÂΩ±ÂÖ≥' : 'Èò¥ÂΩ±ÂºÄ';
            button.classList.toggle('active', isHeadingBlurOn);
        }

        function addContainer() {
            const contentDiv = document.getElementById('content');
            const container = document.createElement('div');
            container.className = 'container-unit';
            container.id = 'container-' + Date.now();
            container.style.background = 'rgba(255, 234, 171, 0.3)';
            container.style.backdropFilter = 'blur(15px)';

            const controlsDiv = document.createElement('div');
            controlsDiv.className = 'container-controls';
            const deleteButton = document.createElement('button');
            deleteButton.className = 'delete-container-button';
            deleteButton.textContent = 'Âà†Èô§ÂÆπÂô®';
            deleteButton.onclick = () => container.remove();
            const bgButton = document.createElement('button');
            bgButton.className = 'change-bg-button';
            bgButton.textContent = 'Êõ¥ÊîπËÉåÊôØ';
            bgButton.onclick = () => changeContainerBackground(container);
            controlsDiv.appendChild(deleteButton);
            controlsDiv.appendChild(bgButton);

            const moduleContainer = document.createElement('div');
            moduleContainer.className = 'module-container module-unit';
            const buttonId = 'buttons-' + Date.now();
            const buttonContainer = document.createElement('div');
            buttonContainer.className = 'add-buttons';
            buttonContainer.id = buttonId;

            const buttons = [
                { label: 'ÊñáÊú¨', class: 'text-btn', onclick: () => addTextArea(buttonId) },
                { label: 'ÂõæÁâá', class: 'image-btn', onclick: () => addImageArea(buttonId) },
                { label: 'Ê†áÈ¢ò30', class: 'heading-btn', onclick: () => addHeading(buttonId, '30px') },
                { label: 'Ê†áÈ¢ò20', class: 'heading-btn', onclick: () => addHeading(buttonId, '20px') },
                { label: 'Ê†áÈ¢ò15', class: 'heading-btn', onclick: () => addHeading(buttonId, '15px') },
                { label: 'ÂàÜÂâ≤Á∫ø', class: 'line-btn', onclick: () => addDividerLine(buttonId) },
                { label: 'Èó¥Èöî', class: 'spacer-btn', onclick: () => addSpacer(buttonId) }
            ];
            
            buttons.forEach(btn => {
                const button = document.createElement('button');
                button.className = `add-button ${btn.class}`;
                button.innerHTML = `<div class="label">${btn.label}</div>`;
                button.onclick = btn.onclick;
                buttonContainer.appendChild(button);
            });

            moduleContainer.appendChild(buttonContainer);
            container.appendChild(controlsDiv);
            container.appendChild(moduleContainer);
            contentDiv.appendChild(container);
        }

        function addContainerWithoutBackground() {
            const contentDiv = document.getElementById('content');
            const container = document.createElement('div');
            container.className = 'container-unit';
            container.id = 'container-' + Date.now();
            container.style.background = 'transparent';
            container.style.backdropFilter = 'none';
            container.setAttribute('data-no-background', 'true');

            const controlsDiv = document.createElement('div');
            controlsDiv.className = 'container-controls';
            const deleteButton = document.createElement('button');
            deleteButton.className = 'delete-container-button';
            deleteButton.textContent = 'Âà†Èô§ÂÆπÂô®';
            deleteButton.onclick = () => container.remove();
            const bgButton = document.createElement('button');
            bgButton.className = 'change-bg-button';
            bgButton.textContent = 'Êõ¥ÊîπËÉåÊôØ';
            bgButton.onclick = () => changeContainerBackground(container);
            controlsDiv.appendChild(deleteButton);
            controlsDiv.appendChild(bgButton);

            const moduleContainer = document.createElement('div');
            moduleContainer.className = 'module-container module-unit';
            const buttonId = 'buttons-' + Date.now();
            const buttonContainer = document.createElement('div');
            buttonContainer.className = 'add-buttons';
            buttonContainer.id = buttonId;

            const buttons = [
                { label: 'ÊñáÊú¨', class: 'text-btn', onclick: () => addTextArea(buttonId) },
                { label: 'ÂõæÁâá', class: 'image-btn', onclick: () => addImageArea(buttonId) },
                { label: 'Ê†áÈ¢ò30', class: 'heading-btn', onclick: () => addHeading(buttonId, '30px') },
                { label: 'Ê†áÈ¢ò20', class: 'heading-btn', onclick: () => addHeading(buttonId, '20px') },
                { label: 'Ê†áÈ¢ò15', class: 'heading-btn', onclick: () => addHeading(buttonId, '15px') },
                { label: 'ÂàÜÂâ≤Á∫ø', class: 'line-btn', onclick: () => addDividerLine(buttonId) },
                { label: 'Èó¥Èöî', class: 'spacer-btn', onclick: () => addSpacer(buttonId) }
            ];
            
            buttons.forEach(btn => {
                const button = document.createElement('button');
                button.className = `add-button ${btn.class}`;
                button.innerHTML = `<div class="label">${btn.label}</div>`;
                button.onclick = btn.onclick;
                buttonContainer.appendChild(button);
            });

            moduleContainer.appendChild(buttonContainer);
            container.appendChild(controlsDiv);
            container.appendChild(moduleContainer);
            contentDiv.appendChild(container);
        }

        function changeContainerBackground(container) {
            const colors = [
                { var: 'var(--bg-pale-yellow)', rgba: 'rgba(255, 234, 171, 0.3)' },
                { var: 'var(--bg-pale-pink)', rgba: 'rgba(255, 230, 230, 0.3)' },
                { var: 'var(--bg-pale-blue)', rgba: 'rgba(230, 243, 255, 0.3)' },
                { var: 'var(--bg-pale-green)', rgba: 'rgba(230, 255, 230, 0.3)' },
                { var: 'var(--bg-pale-gray)', rgba: 'rgba(240, 240, 240, 0.3)' },
                { var: 'transparent', rgba: 'transparent' }
            ];
            
            const currentBg = container.style.background || 'rgba(255, 234, 171, 0.3)';
            let currentIndex = colors.findIndex(color => currentBg.includes(color.rgba.split(',')[0]));
            if (currentIndex === -1) currentIndex = 0;
            
            const nextIndex = (currentIndex + 1) % colors.length;
            const nextColor = colors[nextIndex];
            
            container.style.background = nextColor.rgba;
            if (nextColor.rgba === 'transparent') {
                container.setAttribute('data-no-background', 'true');
                container.style.backdropFilter = 'none';
            } else {
                container.removeAttribute('data-no-background');
                container.style.backdropFilter = 'blur(15px)';
            }
        }

        async function toBase64(url) {
            if (!url || url.startsWith('data:')) {
                return url;
            }
            try {
                const response = await fetch(url);
                const blob = await response.blob();
                return new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.onloadend = () => resolve(reader.result);
                    reader.readAsDataURL(blob);
                });
            } catch (err) {
                console.error('Failed to convert image to base64:', err);
                return '';
            }
        }

        async function shareAllContainers() {
            const isPreviewMode = document.body.classList.contains('preview-mode');
            if (!isPreviewMode) {
                document.body.classList.add('preview-mode');
            }
            const contentDiv = document.getElementById('content');
            const containers = contentDiv.querySelectorAll('.container-unit');
            const clones = [];
            
            for (const container of containers) {
                const clone = container.cloneNode(true);
                clone.querySelectorAll('.container-controls, .add-buttons, .text-buttons, .image-area-buttons, .add-image-button, .delete-image-button').forEach(el => el.remove());
                
                // Set container background color
                const bgColor = container.hasAttribute('data-no-background') && container.getAttribute('data-no-background') === 'true'
                    ? 'transparent'
                    : getComputedStyle(container).backgroundColor;
                clone.style.backgroundColor = bgColor;
                
                // Convert textareas to divs
                clone.querySelectorAll('.text-area').forEach(textarea => {
                    const div = document.createElement('div');
                    div.className = 'text-area';
                    div.innerText = textarea.value;
                    textarea.replaceWith(div);
                });
                
                // Convert images to base64
                const images = clone.querySelectorAll('.inserted-image');
                for (const img of images) {
                    if (img.src) {
                        img.src = await toBase64(img.src);
                    }
                }
                
                // Handle heading backgrounds and blur
                const headings = clone.querySelectorAll('.heading-30px');
                for (const heading of headings) {
                    const bgImage = heading.style.backgroundImage;
                    let blurDiv = heading.querySelector('.heading-30px-blur');
                    if (bgImage && bgImage.includes('url(')) {
                        const url = bgImage.replace(/url\(['"]?(.+?)['"]?\)/, '$1');
                        if (url) {
                            const base64 = await toBase64(url);
                            heading.style.backgroundImage = `url(${base64})`;
                            if (isHeadingBlurOn) {
                                if (!blurDiv) {
                                    blurDiv = document.createElement('div');
                                    blurDiv.className = 'heading-30px-blur';
                                    heading.prepend(blurDiv);
                                }
                                blurDiv.style.backgroundImage = `url(${base64})`;
                            }
                        }
                    }
                    // Apply current text color, border, and blur styles
                    const currentColor = getComputedStyle(document.querySelector('.heading-30px')).color;
                    heading.style.color = currentColor;
                    heading.style.border = isHeadingBorderOn ? `2px solid ${currentColor}` : 'none';
                    heading.style.backgroundColor = isHeadingBlurOn ? 'rgba(255, 255, 255, 0.3)' : '';
                }
                
                clones.push(clone.outerHTML);
            }
            
            if (!isPreviewMode) {
                document.body.classList.remove('preview-mode');
            }

            const styles = `
                <style>
                    * {
                        box-sizing: border-box;
                    }
                    html, body {
                        overflow-x: hidden;
                        margin: 0;
                        padding: 0;
                        width: 100%;
                        background: ${getComputedStyle(document.body).background || 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'};
                        min-height: 100vh;
                    }
                    body {
                        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'Helvetica Neue', Helvetica, Arial, sans-serif;
                        max-width: 375px;
                        margin: 10px auto;
                        padding: 0 5px;
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                    }
                    .content-container {
                        width: 100%;
                        max-width: 375px;
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                    }
                    .container-unit {
                        width: 100%;
                        border: none;
                        padding: 0;
                        margin-bottom: 10px;
                        position: relative;
                        border-radius: 16px;
                        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
                    }
                    .container-unit[data-no-background="true"] {
                        background-color: transparent;
                    }
                    .module-container {
                        width: 100%;
                    }
                    .module-unit {
                        margin-bottom: 2px;
                    }
                    .text-area-container, .heading-container, .image-area, .line-container, .spacer-container {
                        width: 100%;
                        position: relative;
                    }
                    .text-area {
                        width: 100%;
                        height: auto;
                        min-height: auto;
                        resize: none;
                        padding: 5px 12px;
                        padding-left: calc(12px + ${getComputedStyle(document.documentElement).getPropertyValue('--text-area-offset') || '0px'});
                        overflow: visible;
                        font-size: ${getComputedStyle(document.documentElement).getPropertyValue('--text-area-font-size')};
                        line-height: 1.6;
                        border-radius: 2px;
                        text-indent: 2em;
                        text-align: ${getComputedStyle(document.documentElement).getPropertyValue('--text-area-alignment')};
                        border: none;
                        pointer-events: none;
                        font-family: SimSun, Arial, sans-serif;
                        white-space: pre-wrap;
                        background: none;
                    }
                    .heading-30px, .heading-20px, .heading-15px {
                        width: 100%;
                        font-weight: bold;
                        text-align: center;
                        border: none;
                        box-sizing: border-box;
                        font-family: ${getComputedStyle(document.documentElement).getPropertyValue('--heading-30px-font')};
                        pointer-events: none;
                        position: relative;
                    }
                    .heading-30px {
                        font-size: 30px;
                        color: ${getComputedStyle(document.querySelector('.heading-30px')).color};
                        padding: 30px;
                        background-color: ${isHeadingBlurOn ? 'rgba(255, 255, 255, 0.3)' : 'var(--bg-pale-pink)'};
                        width: 100%;
                        position: relative;
                        background-size: cover;
                        background-position: center;
                        margin-bottom: -3px;
                        border-radius: ${isHeadingExpandOn ? '0' : '10px'};
                        border: ${isHeadingBorderOn ? `2px solid ${getComputedStyle(document.querySelector('.heading-30px')).color}` : 'none'};
                        text-shadow: ${isHeadingBlurOn ? '0 4px 8px rgba(0, 0, 0, 0.3), 0 2px 4px rgba(0, 0, 0, 0.2)' : 'none'};
                        box-shadow: ${isHeadingBlurOn ? '0 8px 32px rgba(0, 0, 0, 0.2), 0 4px 16px rgba(0, 0, 0, 0.1)' : 'none'};
                        width: ${isHeadingExpandOn ? 'calc(100% + 20px)' : '100%'};
                        margin-left: ${isHeadingExpandOn ? '-10px' : '0'};
                        margin-right: ${isHeadingExpandOn ? '-10px' : '0'};
                    }
                    .heading-30px-blur {
                        position: absolute;
                        top: 0;
                        left: 0;
                        right: 0;
                        bottom: 0;
                        background-size: cover;
                        background-position: center;
                        filter: blur(25px);
                        overflow: hidden;
                        z-index: -1;
                        border-radius: ${isHeadingExpandOn ? '0' : '10px'};
                    }
                    .heading-20px {
                        font-size: 20px;
                        padding: 5px 5px;
                        background: none;
                        width: 150%;
                        position: relative;
                        left: -25%;
                    }
                    .heading-15px {
                        font-size: 15px;
                        padding: 2px 5px;
                        background: none;
                    }
                    .image-area {
                        border: none;
                        padding: 0;
                    }
                    .image-grid {
                        margin-bottom: 2px;
                    }
                    .image-grid.single {
                        display: block;
                        padding: 5px;
                    }
                    .image-grid.two {
                        display: flex;
                        gap: 2px;
                        padding: 5px;
                    }
                    .image-grid.multiple {
                        column-count: 2;
                        column-gap: 2px;
                        column-width: calc((100% - 2px) / 2);
                        padding: 5px;
                    }
                    .image-container {
                        width: 100%;
                        margin-bottom: 2px;
                        border-radius: 8px;
                        overflow: hidden;
                    }
                    .image-grid.two .image-container {
                        flex: 1;
                    }
                    .inserted-image {
                        width: 100%;
                        height: auto;
                        display: block;
                        border-radius: 8px;
                    }
                    .divider-line {
                        width: calc(100% - 10px);
                        height: 1px;
                        background-color: #ccc;
                        margin: 0 auto;
                    }
                    .spacer {
                        height: 10px;
                        background-color: white;
                    }
                </style>
            `;

            const htmlContent = `
                <!DOCTYPE html>
                <html lang="en">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
                    <title>WeChat Article</title>
                    ${styles}
                </head>
                <body>
                    <div class="content-container">
                        ${clones.join('\n')}
                    </div>
                </body>
                </html>
            `;

            const blob = new Blob([htmlContent], { type: 'text/html' });
            const file = new File([blob], `article-${Date.now()}.html`, { type: 'text/html' });

            if (navigator.share) {
                navigator.share({
                    files: [file],
                    title: 'WeChat Article',
                    text: 'Share this article to WeChat or other apps'
                }).catch(err => {
                    console.error('Share failed:', err);
                    fallbackDownload(file);
                });
            } else {
                fallbackDownload(file);
            }
        }

        function fallbackDownload(file) {
            const url = URL.createObjectURL(file);
            const a = document.createElement('a');
            a.href = url;
            a.download = file.name;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function createModuleContainer(contentElement, buttonId) {
            const moduleContainer = document.createElement('div');
            moduleContainer.className = 'module-container module-unit';
            
            const newButtonId = 'buttons-' + Date.now();
            const newButtonContainer = document.createElement('div');
            newButtonContainer.className = 'add-buttons';
            newButtonContainer.id = newButtonId;
            
            const buttons = [
                { label: 'ÊñáÊú¨', class: 'text-btn', onclick: () => addTextArea(newButtonId) },
                { label: 'ÂõæÁâá', class: 'image-btn', onclick: () => addImageArea(newButtonId) },
                { label: 'Ê†áÈ¢ò30', class: 'heading-btn', onclick: () => addHeading(newButtonId, '30px') },
                { label: 'Ê†áÈ¢ò20', class: 'heading-btn', onclick: () => addHeading(newButtonId, '20px') },
                { label: 'Ê†áÈ¢ò15', class: 'heading-btn', onclick: () => addHeading(newButtonId, '15px') },
                { label: 'ÂàÜÂâ≤Á∫ø', class: 'line-btn', onclick: () => addDividerLine(newButtonId) },
                { label: 'Èó¥Èöî', class: 'spacer-btn', onclick: () => addSpacer(newButtonId) }
            ];
            
            buttons.forEach(btn => {
                const button = document.createElement('button');
                button.className = `add-button ${btn.class}`;
                button.innerHTML = `<div class="label">${btn.label}</div>`;
                button.onclick = btn.onclick;
                newButtonContainer.appendChild(button);
            });
            
            moduleContainer.appendChild(contentElement);
            moduleContainer.appendChild(newButtonContainer);
            return { moduleContainer, newButtonId };
        }

        function addTextArea(buttonId) {
            const buttonContainer = document.getElementById(buttonId);
            const containerUnit = buttonContainer.closest('.container-unit');
            const moduleContainer = buttonContainer.closest('.module-container');
            
            const container = document.createElement('div');
            container.className = 'text-area-container';
            
            const textArea = document.createElement('textarea');
            textArea.className = 'text-area';
            textArea.placeholder = 'Âú®Ê≠§ËæìÂÖ•ÊñáÊú¨';
            
            // Â∫îÁî®ÂΩìÂâçÁöÑÂÅèÁßªÂÄº
            const currentOffset = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--text-area-offset')) || 0;
            textArea.style.paddingLeft = `calc(12px + ${currentOffset}px)`;
            
            textArea.oninput = () => {
                if (document.body.classList.contains('preview-mode')) {
                    textArea.style.height = 'auto';
                    textArea.style.height = `${textArea.scrollHeight}px`;
                }
            };
            
            const buttonDiv = document.createElement('div');
            buttonDiv.className = 'text-buttons';
            const selectButton = document.createElement('button');
            selectButton.className = 'text-button';
            selectButton.textContent = 'ÂÖ®ÈÄâ';
            selectButton.onclick = () => {
                textArea.select();
            };
            const pasteButton = document.createElement('button');
            pasteButton.className = 'text-button';
            pasteButton.textContent = 'Á≤òË¥¥';
            pasteButton.onclick = async () => {
                try {
                    const text = await navigator.clipboard.readText();
                    textArea.value = text;
                    if (document.body.classList.contains('preview-mode')) {
                        textArea.style.height = 'auto';
                        textArea.style.height = `${textArea.scrollHeight}px`;
                    }
                } catch (err) {
                    console.error('Failed to paste:', err);
                }
            };
            const clearButton = document.createElement('button');
            clearButton.className = 'clear-button';
            clearButton.textContent = 'Ê∏ÖÁ©∫';
            clearButton.onclick = () => {
                textArea.value = '';
                if (document.body.classList.contains('preview-mode')) {
                    textArea.style.height = 'auto';
                    textArea.style.height = `${textArea.scrollHeight}px`;
                }
            };
            const deleteModuleButton = document.createElement('button');
            deleteModuleButton.className = 'delete-module-button';
            deleteModuleButton.textContent = 'Âà†Èô§';
            deleteModuleButton.onclick = () => {
                container.parentNode.remove();
            };
            buttonDiv.appendChild(selectButton);
            buttonDiv.appendChild(pasteButton);
            buttonDiv.appendChild(clearButton);
            buttonDiv.appendChild(deleteModuleButton);
            
            container.appendChild(textArea);
            container.appendChild(buttonDiv);
            
            const { moduleContainer: newModuleContainer, newButtonId } = createModuleContainer(container, buttonId);
            
            containerUnit.insertBefore(newModuleContainer, moduleContainer.nextSibling);
        }

        function addHeading(buttonId, size) {
            const buttonContainer = document.getElementById(buttonId);
            const containerUnit = buttonContainer.closest('.container-unit');
            const moduleContainer = buttonContainer.closest('.module-container');
            
            const container = document.createElement('div');
            container.className = 'heading-container';
            
            const heading = document.createElement('div');
            heading.className = `heading-${size}`;
            heading.contentEditable = true;
            heading.textContent = 'ËæìÂÖ•Ê†áÈ¢ò';
            
            // Â∫îÁî®ÂΩìÂâçÈÄâÊã©ÁöÑÂ≠ó‰Ωì
            const currentFont = getComputedStyle(document.documentElement).getPropertyValue('--heading-30px-font').trim() || "'Noto Serif SC', serif";
            heading.style.fontFamily = currentFont;
            
            // Â∫îÁî®ÂΩìÂâçÁöÑÂä†ÂÆΩÁä∂ÊÄÅÔºà‰ªÖÂØπ30pxÊ†áÈ¢òÔºâ
            if (size === '30px' && isHeadingExpandOn) {
                heading.style.width = 'calc(100% + 20px)';
                heading.style.marginLeft = '-10px';
                heading.style.marginRight = '-10px';
                heading.style.borderRadius = '0';
            }
            
            console.log('New heading font:', currentFont); // Ë∞ÉËØïÁî®
            
            const buttonDiv = document.createElement('div');
            buttonDiv.className = 'text-buttons';
            const selectButton = document.createElement('button');
            selectButton.className = 'text-button';
            selectButton.textContent = 'ÂÖ®ÈÄâ';
            selectButton.onclick = () => {
                const range = document.createRange();
                range.selectNodeContents(heading);
                const selection = window.getSelection();
                selection.removeAllRanges();
                selection.addRange(range);
            };
            const pasteButton = document.createElement('button');
            pasteButton.className = 'text-button';
            pasteButton.textContent = 'Á≤òË¥¥';
            pasteButton.onclick = async () => {
                try {
                    const text = await navigator.clipboard.readText();
                    heading.textContent = text;
                } catch (err) {
                    console.error('Failed to paste:', err);
                }
            };
            const clearButton = document.createElement('button');
            clearButton.className = 'clear-button';
            clearButton.textContent = 'Ê∏ÖÁ©∫';
            clearButton.onclick = () => {
                heading.textContent = '';
            };
            const deleteModuleButton = document.createElement('button');
            deleteModuleButton.className = 'delete-module-button';
            deleteModuleButton.textContent = 'Âà†Èô§';
            deleteModuleButton.onclick = () => {
                container.parentNode.remove();
            };
            
            if (size === '30px') {
                const backgroundButton = document.createElement('button');
                backgroundButton.className = 'background-button';
                backgroundButton.textContent = 'ÈÄâÊã©ËÉåÊôØÂõæÁâá';
                
                const fileInputId = 'background-upload-' + Date.now();
                const fileInput = document.createElement('input');
                fileInput.type = 'file';
                fileInput.accept = 'image/*';
                fileInput.className = 'hidden';
                fileInput.id = fileInputId;
                fileInput.onchange = (e) => setHeadingBackground(e.target, heading);
                
                backgroundButton.onclick = () => fileInput.click();
                
                buttonDiv.appendChild(backgroundButton);
                buttonDiv.appendChild(fileInput);
            }
            
            buttonDiv.appendChild(selectButton);
            buttonDiv.appendChild(pasteButton);
            buttonDiv.appendChild(clearButton);
            buttonDiv.appendChild(deleteModuleButton);
            
            container.appendChild(heading);
            container.appendChild(buttonDiv);
            
            const { moduleContainer: newModuleContainer, newButtonId } = createModuleContainer(container, buttonId);
            
            containerUnit.insertBefore(newModuleContainer, moduleContainer.nextSibling);
        }

        function setHeadingBackground(input, heading) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    heading.style.backgroundImage = `url(${e.target.result})`;
                    
                    // Â¶ÇÊûúËÉåÊôØÊ®°Á≥äÂºÄÂÖ≥ÊòØÂºÄÂêØÁöÑÔºåËá™Âä®Â∫îÁî®Ê®°Á≥äÊïàÊûú
                    if (isBackgroundBlurOn) {
                        let blurOverlay = heading.querySelector('.heading-blur-overlay');
                        if (!blurOverlay) {
                            blurOverlay = document.createElement('div');
                            blurOverlay.className = 'heading-blur-overlay';
                            heading.appendChild(blurOverlay);
                        }
                        
                        // ËÆæÁΩÆÊñ∞ÁöÑÊ®°Á≥äË¶ÜÁõñÂ±Ç
                        blurOverlay.style.position = 'absolute';
                        blurOverlay.style.top = '0';
                        blurOverlay.style.left = '0';
                        blurOverlay.style.right = '0';
                        blurOverlay.style.bottom = '0';
                        blurOverlay.style.width = '100%';
                        blurOverlay.style.height = '100%';
                        blurOverlay.style.backgroundImage = `url(${e.target.result})`;
                        blurOverlay.style.backgroundSize = 'cover';
                        blurOverlay.style.backgroundPosition = 'center';
                        blurOverlay.style.filter = 'blur(8px)';
                        blurOverlay.style.zIndex = '0';
                        blurOverlay.style.borderRadius = isHeadingExpandOn ? '0' : '10px';
                        blurOverlay.style.overflow = 'hidden';
                        
                        // ËÆæÁΩÆÊ†áÈ¢òÂÆπÂô®
                        heading.style.position = 'relative';
                        heading.style.overflow = 'hidden';
                        heading.style.zIndex = '1';
                        heading.style.color = 'white';
                        heading.style.textShadow = '0 2px 4px rgba(0, 0, 0, 0.8), 0 1px 2px rgba(0, 0, 0, 0.6)';
                    }
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function selectHeadingText(button) {
            const heading = button.closest('.module-container').querySelector('[contenteditable]');
            const range = document.createRange();
            range.selectNodeContents(heading);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
        }

        function pasteHeadingText(button) {
            const heading = button.closest('.module-container').querySelector('[contenteditable]');
            navigator.clipboard.readText().then(text => {
                heading.textContent = text;
            }).catch(err => {
                console.error('Failed to paste:', err);
            });
        }

        function clearHeadingText(button) {
            const heading = button.closest('.module-container').querySelector('[contenteditable]');
            heading.textContent = '';
        }

        function addImageArea(buttonId) {
            const buttonContainer = document.getElementById(buttonId);
            const containerUnit = buttonContainer.closest('.container-unit');
            const moduleContainer = buttonContainer.closest('.module-container');
            
            const imageArea = document.createElement('div');
            imageArea.className = 'image-area';
            
            const imageGrid = document.createElement('div');
            imageGrid.className = 'image-grid single';
            imageArea.appendChild(imageGrid);
            
            const addButton = document.createElement('button');
            addButton.className = 'add-image-button';
            addButton.textContent = '+';
            
            const fileInputId = 'image-upload-' + Date.now();
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = 'image/*';
            fileInput.className = 'hidden';
            fileInput.id = fileInputId;
            fileInput.onchange = (e) => insertImage(e.target, imageGrid);
            
            addButton.onclick = () => fileInput.click();
            
            const buttonDiv = document.createElement('div');
            buttonDiv.className = 'image-area-buttons';
            const deleteModuleButton = document.createElement('button');
            deleteModuleButton.className = 'delete-module-button';
            deleteModuleButton.textContent = 'Âà†Èô§';
            deleteModuleButton.onclick = () => {
                imageArea.parentNode.remove();
            };
            buttonDiv.appendChild(deleteModuleButton);
            
            imageArea.appendChild(addButton);
            imageArea.appendChild(fileInput);
            imageArea.appendChild(buttonDiv);
            
            const { moduleContainer: newModuleContainer, newButtonId } = createModuleContainer(imageArea, buttonId);
            
            containerUnit.insertBefore(newModuleContainer, moduleContainer.nextSibling);
        }

        function insertImage(input, imageGrid) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imageContainer = document.createElement('div');
                    imageContainer.className = 'image-container';
                    
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.className = 'inserted-image';
                    
                    const deleteImageButton = document.createElement('button');
                    deleteImageButton.className = 'delete-image-button';
                    deleteImageButton.textContent = 'Âà†Èô§ÂõæÁâá';
                    deleteImageButton.onclick = () => {
                        imageContainer.remove();
                        const imageCount = imageGrid.querySelectorAll('img').length - 1;
                        imageGrid.className = 'image-grid ' + (imageCount === 1 ? 'single' : imageCount === 2 ? 'two' : 'multiple');
                    };
                    
                    imageContainer.appendChild(img);
                    imageContainer.appendChild(deleteImageButton);
                    imageGrid.appendChild(imageContainer);
                    
                    const imageCount = imageGrid.querySelectorAll('img').length;
                    imageGrid.className = 'image-grid ' + (imageCount === 1 ? 'single' : imageCount === 2 ? 'two' : 'multiple');
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function addDividerLine(buttonId) {
            const buttonContainer = document.getElementById(buttonId);
            const containerUnit = buttonContainer.closest('.container-unit');
            const moduleContainer = buttonContainer.closest('.module-container');
            
            const container = document.createElement('div');
            container.className = 'line-container';
            
            const line = document.createElement('div');
            line.className = 'divider-line';
            
            const buttonDiv = document.createElement('div');
            buttonDiv.className = 'text-buttons';
            const deleteModuleButton = document.createElement('button');
            deleteModuleButton.className = 'delete-module-button';
            deleteModuleButton.textContent = 'Âà†Èô§';
            deleteModuleButton.onclick = () => {
                container.parentNode.remove();
            };
            buttonDiv.appendChild(deleteModuleButton);
            
            container.appendChild(line);
            container.appendChild(buttonDiv);
            
            const { moduleContainer: newModuleContainer, newButtonId } = createModuleContainer(container, buttonId);
            
            containerUnit.insertBefore(newModuleContainer, moduleContainer.nextSibling);
        }

        function addSpacer(buttonId) {
            const buttonContainer = document.getElementById(buttonId);
            const containerUnit = buttonContainer.closest('.container-unit');
            const moduleContainer = buttonContainer.closest('.module-container');
            
            const container = document.createElement('div');
            container.className = 'spacer-container';
            
            const spacer = document.createElement('div');
            spacer.className = 'spacer';
            
            const buttonDiv = document.createElement('div');
            buttonDiv.className = 'text-buttons';
            const deleteModuleButton = document.createElement('button');
            deleteModuleButton.className = 'delete-module-button';
            deleteModuleButton.textContent = 'Âà†Èô§';
            deleteModuleButton.onclick = () => {
                container.parentNode.remove();
            };
            buttonDiv.appendChild(deleteModuleButton);
            
            container.appendChild(spacer);
            container.appendChild(buttonDiv);
            
            const { moduleContainer: newModuleContainer, newButtonId } = createModuleContainer(container, buttonId);
            
            containerUnit.insertBefore(newModuleContainer, moduleContainer.nextSibling);
        }
    </script>
</body>
</html>
